import{_ as bt,D as St,p as q,au as wt,v as yt,u as Rt,q as Oe,$ as Lt,C as we,b as W,o as v,w as L,G as R,e as ie,j as w,c as y,F as U,B as z,t as m,a as X,ac as kt,ad as xt,P as Mt}from"./framework.B0z-tEu9.js";import{u as Tt,a as Pt,o as At,b as Ve}from"./index.DLADelvP.js";import{m as M,l as _t,a as Et,d as Dt}from"./opencvLoader.Xwn5jepb.js";import{A as It,U as Bt,S as Ft,D as Nt}from"./theme.Cg498M9D.js";const s={},c={},We={root:s,en:c};s.FunctionIntroductionTitle="功能简介";c.FunctionIntroductionTitle="Function Introduction";s.FunctionIntroductionContent=["1.  点击读取图片文件。读取的图片文件将直接灰度化。","2.  裁剪图片为合适的尺寸。短按控制边框；长按清空已有选框。","3.  选择基底线、液滴边缘线。"];c.FunctionIntroductionContent=["1.  Click to read the image file. The read image file will be directly grayed out.","2.  Crop the image to the appropriate size. Short press to control the border; Long press to clear the existing selection box.","3.  Select the baseline and the edge of the droplet."];s.SetpTitle="步骤";c.SetpTitle="Step ";s.Setp1Content=["首先点击“点击上传图片”读取图片。","读取到的图片会自动进行灰度化渲染。"];c.Setp1Content=["First click on the 'Click to upload image' to read the image.","The read image will be automatically rendered in grayscale."];s.Setp2Content=["接下来需要将图片裁剪为合适的尺寸。","点击/触控图片，短按可控制边框；长按可清空已有选框。","可通过下方“裁剪图片”按钮多次裁剪，直到满意后，点击下方“完成裁剪”按钮进入下一步。"];c.Setp2Content=["Next, you need to crop the image to the appropriate size.","Click/touch the image, short press to control the border; Long press to clear the existing selection box.","You can crop the image multiple times by clicking the 'Crop Image' button below, and click the 'Finish Cropping' button below to proceed to the next step after you are satisfied."];s.Setp3Content=["接下来寻找液滴的最佳轮廓。","调节滑轨可调整参数并查看轮廓效果；点击图片左部或右部可设置遮罩，被遮罩的轮廓点将不会参与后续拟合。"];c.Setp3Content=["Next, find the best contour of the droplet.","Adjust the slider to adjust the parameters and view the contour effect; Click on the left or right side of the image to set the mask, the contour points that are masked will not participate in the subsequent fitting."];s.Setp4Content=["接下来寻找固体基底与液滴接触的“基线”。","点击/触控图片以粗调基线位置；调节滑轨以细调。"];c.Setp4Content=["Next, find the baseline where the solid substrate and the droplet contact.","Click / touch the image to coarse tune the baseline position; Adjust the slider to fine tune."];s.ContourAlgorithmTitle="轮廓/边缘检测";c.ContourAlgorithmTitle="Contour / Edge Detection";s.CannyAlgorithmLabel="Canny算法";c.CannyAlgorithmLabel="Canny Algorithm";s.ThresholdingMethodLabel="阈值化法";c.ThresholdingMethodLabel="Thresholding Method";s.ContourAlgorithmContent=[{strong:s.CannyAlgorithmLabel,normal:"。是一种多阶段的边缘检测算法，由John F. Canny提出。其原理为计算图像中像素色阶变化的梯度及方向，得到“边缘”图案。然后通过给定的两个阈值参数以筛选出合适的轮廓。"},"主参数：亦称“高阈值”，所有色阶变化高于此参数的边缘，都将被认定为“轮廓”。","辅助参数：亦称“低阈值”，对于色阶变化小于“高阈值”、但与轮廓相连的边缘而言，若其色阶变化大于“低阈值”，则也将被认定为轮廓的一部分。以此确保轮廓的完整性。",{strong:s.ThresholdingMethodLabel,normal:"。是一种传统的二值化处理方法。其原理为将图像中的像素色阶值与所给定的阈值进行比较，大于阈值的像素值将被设定为“白色”，小于阈值的像素值将被设定为“黑色”。然后将黑白之间的边界线认定为轮廓。"},"主参数：亦称“阈值”，所有色阶值高于此参数的像素，都将被认定为“白色”。"];c.ContourAlgorithmContent=[{strong:c.CannyAlgorithmLabel,normal:". is a multi-stage edge detection algorithm proposed by John F. Canny. Its principle is to calculate the gradient and direction of the color grade change of pixels in the image, and get the 'edge' pattern. Then, through the given two threshold parameters, the appropriate contour is filtered out."},"Main parameter: also known as 'high threshold', all edges with color grade changes higher than this parameter will be considered as 'contour'.","Auxiliary parameter: also known as 'low threshold', for edges with color grade changes less than 'high threshold' but connected to the contour, if its color grade change is greater than 'low threshold', it will also be considered as part of the contour. This ensures the integrity of the contour.",{strong:c.ThresholdingMethodLabel,normal:". is a traditional binary processing method. Its principle is to compare the color grade value of the pixel in the image with the given threshold, and pixels with color grade values greater than the threshold will be set to 'white', and pixels with color grade values less than the threshold will be set to 'black'. Then, the boundary line between black and white is regarded as the contour."},"Main parameter: also known as 'threshold', all pixels with color grade values higher than this parameter will be considered as 'white'."];s.ContourMaskTitle="遮罩";c.ContourMaskTitle="Contour Mask";s.ContourMaskSideLabel="两边遮罩";c.ContourMaskSideLabel="Side Masks";s.ContourMaskCentralLabel="中心遮罩";c.ContourMaskCentralLabel="Central Mask";s.ContourMaskContent=[{strong:s.ContourMaskSideLabel,normal:"。用于去除轮廓两边基线误识别的伪轮廓。"},"点击图片左部或右部设置遮罩，被遮罩的轮廓点将不会参与后续拟合。",{strong:s.ContourMaskCentralLabel,normal:"。用于去除轮廓中心因光源投影而产生的伪轮廓。"},"点击图片，短按可控制边框；边框所包围区域内的轮廓点将不会参与后续拟合。"];c.ContourMaskContent=[{strong:c.ContourMaskSideLabel,normal:". is used to remove the pseudo contour of the contour base line misrecognition on both sides of the contour."},"Click on the left or right side of the image to set the mask, the contour points that are masked will not participate in the subsequent fitting.",{strong:c.ContourMaskCentralLabel,normal:". is used to remove the pseudo contour of the contour center caused by the projection of the light source."},"Click on the image, short press to control the border; the contour points within the border will not participate in the subsequent fitting."];s.CutPictureButtonText="裁剪图片";c.CutPictureButtonText="Cut Picture";s.CutPictureCompleteButtonText="裁剪完成";c.CutPictureCompleteButtonText="Complete Cut";s.ContourSliderMainParameterChangeLabel="主参数（G色阶变化）：";c.ContourSliderMainParameterChangeLabel="Main Parameter (G color grade change): ";s.ContourSliderMainParameterValueLabel="主参数（G色阶值）：";c.ContourSliderMainParameterValueLabel="Main Parameter (G color grade value): ";s.ContourSliderAuxiliaryParameterLabel="辅助参数（G色阶变化）：";c.ContourSliderAuxiliaryParameterLabel="Auxiliary Parameter (G color grade change): ";s.ContourSliderSwitchFineButtonLabel="切换细调";c.ContourSliderSwitchFineButtonLabel="Switch Fine Tuning";s.ContourSliderSwitchCoarseButtonLabel="切换粗调";c.ContourSliderSwitchCoarseButtonLabel="Switch Coarse Tuning";s.ContourDetermineButtonLabel="确认轮廓";c.ContourDetermineButtonLabel="Confirm Contour";s.InterceptLeftSliderLabel="【微调】左截距（px）：";c.InterceptLeftSliderLabel="【Fine Tuning】Left Intercept (px): ";s.InterceptRightSliderLabel="【微调】右截距（px）：";c.InterceptRightSliderLabel="【Fine Tuning】Right Intercept (px): ";s.StepBackButtonLabel="返回上一步";c.StepBackButtonLabel="Step Back";s.BaselineConfirmButtonLabel="确认基线";c.BaselineConfirmButtonLabel="Confirm Baseline";s.ResultTableContent=["序号","文件名","接触角 (°)","偏差 (°)","左接触角 (°)","右接触角 (°)","基线角度 (°)","椭圆拟合R²"];c.ResultTableContent=["No.","Filename","Contact Angle (°)","Deviation (°)","Left Contact Angle (°)","Right Contact Angle (°)","Baseline Angle (°)","Ellipse Fitting R²"];s.ResultTableProcessingLabel="处理";c.ResultTableProcessingLabel="Process";s.ResultTableDeleteButtonLabel="删除";c.ResultTableDeleteButtonLabel="Delete";s.ResultTableExportButtonLabel="下载结果";c.ResultTableExportButtonLabel="Download Result";s.DeleteAllResultButtonLabel="清空结果";c.DeleteAllResultButtonLabel="Clear Result";s.OpenCVLoadingContent="正在启动OpenCV.js计算机视觉模块，请稍候...";c.OpenCVLoadingContent="Starting OpenCV.js computer vision module, please wait...";s.ErrorDialogTitle="程序报错";c.ErrorDialogTitle="Program Error";s.ErrorDialogContent="欢迎向软件开发人员（13611580728 司承运）主动告知此bug，以便及时修复。";c.ErrorDialogContent="Welcome to inform the software development personnel (+8613611580728 SI_Cheng-Yun) of this bug actively so that it can be repaired in time.";s.PicLoadingContent="正在读取照片...";c.PicLoadingContent="Loading picture...";s.ContourFitLoadingContent="正在拟合液滴轮廓...";c.ContourFitLoadingContent="Fitting droplet contour...";s.ContourFitErrorContent="轮廓点数据不够，无法拟合。";c.ContourFitErrorContent="Not enough contour points data, cannot fit.";s.ContourFitIterationErrorContent="有效数据点不足，已强行停止迭代。请仔细权衡本次轮廓拟合结果！";c.ContourFitIterationErrorContent="Insufficient valid data points, iteration has been forcibly stopped. Please carefully weigh the contour fitting results this time!";s.ResultDialogContent=["本次所测得接触角为 ","° 。可调整参数多次测量，具体结果详见下方数据表格。"];c.ResultDialogContent=["The contact angle measured this time is ","° . You can adjust the parameters multiple times to measure, and the specific results can be seen in the data table below."];s.ContactErrorMessageContent="计算出错，拟合轮廓与基线无交点。";c.ContactErrorMessageContent="Calculation error, the fitted contour and baseline have no intersection.";s.ResultSheetLabel="接触角数据";c.ResultSheetLabel="Contact_Angle_Data";s.DeleteUniResultDialogContent="确定要删除该结果吗？";c.DeleteUniResultDialogContent="Are you sure you want to delete this result?";s.DeleteAllResultDialogContent="确定要删除全部结果吗？";c.DeleteAllResultDialogContent="Are you sure you want to delete all results?";s.DeleteResultDialogConfirmBtnLabel="确定";c.DeleteResultDialogConfirmBtnLabel="Confirm";s.DeleteResultDialogCancelBtnLabel="取消";c.DeleteResultDialogCancelBtnLabel="Cancel";s.DeleteUniResultMessageContent="删除成功！";c.DeleteUniResultMessageContent="Deleted successfully!";const Xt={key:0},Yt={key:1},Ht={key:0},Ot={key:1},Vt={style:{width:"100%"}},Wt={key:4,class:"center"},Ut={key:0},zt={key:1},Gt={class:"center"},jt={class:"center"},qt={class:"center"},Jt={class:"center"},$t={__name:"ContactAngle",setup(Kt){const r=St(We.root),k=q(1),Ae=q([]),g=wt("canvasRef"),ne=Tt(g),b=q([255,0,0,255,0,85,170,255,0,255,0,85,170,255]),Z=q(!1),J=q(!0),se=q(!1),S=q([0,0]),O=q([]),e={cv:null,canvasStyleWidth:null,filename:null,ctx:null,canvasScaling:0,matGray:null,imageData:null,rectXmax:null,rectYmax:null,rectXmin:null,rectYmin:null,contourFilterLineLeft:null,contourFilterLineRight:null,ellipseObj:null,ellipseR2:null,baselinePoint:null},{elementX:ye,elementY:_e}=Pt(g);yt(()=>{const t=Rt().localeIndex.value;if(t!=="root"&&(r.value=We[t]),window.addEventListener("beforeunload",Ee),O.value=JSON.parse(localStorage.getItem("contactAngleResult"))||[],!g.value||!ne.value){const{stop:n}=Oe([g,ne],o=>{const[l,i]=o;l&&i&&(n(),e.canvasStyleWidth=ne.value.clientWidth,g.value.style.width=e.canvasStyleWidth+"px")})}else e.canvasStyleWidth=ne.value.clientWidth,g.value.style.width=e.canvasStyleWidth+"px";M.loading(r.value.OpenCVLoadingContent),_t().then(n=>{e.cv=n,M.loading(!1)}),Oe(k,()=>{Mt(()=>{g.value.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})})}),At(g,Ue)}),Lt(()=>{window.removeEventListener("beforeunload",Ee)});function Ee(t){t.preventDefault(),t.returnValue=!1}function Ue(){try{k.value===2&&(ce(),e.ctx.putImageData(e.imageData,0,0))}catch(t){console.log("onCanvasLongPress()报错：",t),E()}}function ze(){try{const t=k.value;t===2?(De(),Je()):t===3?se.value?nt():tt():t===4&&ht()}catch(t){console.log("onCanvasClick()报错：",t),E()}}function ce(){try{e.rectXmax=null,e.rectYmax=null,e.rectXmin=null,e.rectYmin=null}catch(t){throw console.log("canvasRectDataRemove()报错：",t),Error(t)}}function ue(){try{e.ctx.strokeStyle="red",e.ctx.lineWidth=2*e.canvasScaling,e.ctx.fillStyle="rgba(0, 0, 0, 0.5)"}catch(t){throw console.log("ctxSetting()报错：",t),Error(t)}}function he(){try{const t=k.value;t===3?ot(!1):t===4&&gt()}catch(t){console.log("onSlideChange()报错：",t),E()}}function ge(){try{k.value===3&&J.value===!1?Be():k.value===4&&le()}catch(t){console.log("onContourSlideChangeEnd()报错：",t),E()}}function E(){M.dialog({theme:"danger",header:r.value.ErrorDialogTitle,body:r.value.ErrorDialogContent})}function Ge(){try{k.value=1,ce(),se.value=!1}catch(t){throw console.log("taskToStep1()报错：",t),Error(t)}}async function je(t){var n;try{if(t.length===0){Ge();return}M.loading(r.value.PicLoadingContent),e.filename=t[0].name;const o=URL.createObjectURL(t[0].raw),l=new Image;l.style.display="none",l.src=o,await l.decode(),e.canvasScaling=l.naturalWidth/e.canvasStyleWidth,g.value.style.height=l.naturalHeight/e.canvasScaling+"px";const i=e.cv.imread(l);l.remove(),(n=e.matGray)!=null&&n.delete&&e.matGray.delete(),e.matGray=new e.cv.Mat,e.cv.cvtColor(i,e.matGray,e.cv.COLOR_RGBA2GRAY,0),e.cv.imshow(g.value,e.matGray),i.delete(),e.ctx=g.value.getContext("2d"),ue(),e.imageData=e.ctx.getImageData(0,0,g.value.width,g.value.height),qe(),M.loading(!1)}catch(o){M.loading(!1),console.log("onPicChange()方法出错：",o),E()}}function qe(){try{k.value=2}catch(t){throw console.log("taskToStep2()方法出错：",t),Error(t)}}function De(){try{const t=ye.value*e.canvasScaling,n=_e.value*e.canvasScaling;if(!e.rectXmax){const h=g.value.width,d=g.value.height,p=Math.min(h/4,d/4),x=p*2/3;e.rectXmax=Math.min(t+p,h),e.rectYmax=Math.min(n+x,d),e.rectXmin=Math.max(t-p,0),e.rectYmin=Math.max(n-x,0);return}if(t===e.rectXmax||t===e.rectXmin||n===e.rectYmax||n===e.rectYmin)return;let o=0;if(t>e.rectXmax?e.rectXmax=t:t<e.rectXmin?e.rectXmin=t:o++,n>e.rectYmax?e.rectYmax=n:n<e.rectYmin?e.rectYmin=n:o++,o!==2)return;const l=(e.rectYmax-e.rectYmin)/(e.rectXmax-e.rectXmin),i=(n-e.rectYmin)/(t-e.rectXmin),u=(n-e.rectYmin)/(t-e.rectXmax);i>=l?u<=-l?e.rectYmax=n:e.rectXmin=t:u<=-l?e.rectXmax=t:e.rectYmin=n;return}catch(t){throw console.log("chooseRect()方法出错：",t),Error(t)}}function Je(){try{e.ctx.putImageData(e.imageData,0,0),e.ctx.strokeRect(e.rectXmin,e.rectYmin,e.rectXmax-e.rectXmin,e.rectYmax-e.rectYmin)}catch(t){throw console.log("drawRect()方法出错：",t),Error(t)}}function $e(){try{Ie(!1)}catch(t){console.log("onSureRect()方法出错：",t),E()}}function Ke(){try{Ie(!0)}catch(t){console.log("onDetermineRect()方法出错：",t),E()}}function Ie(t=!1){try{if(!e.rectXmax){t===!0&&(ce(),e.canvasScaling=g.value.width/ne.value.clientWidth,k.value=3);return}const n=e.rectXmax-e.rectXmin,o=e.rectYmax-e.rectYmin,l=new e.cv.Rect(e.rectXmin,e.rectYmin,n,o);ce();let i=e.matGray.roi(l);e.cv.imshow(g.value,i),e.matGray.delete(),e.matGray=i,i=null,e.canvasScaling=n/e.canvasStyleWidth,g.value.style.height=o/e.canvasScaling+"px",ue(),e.imageData=e.ctx.getImageData(0,0,g.value.width,g.value.height),t&&Qe()}catch(n){throw console.log("sureRect()方法出错：",n),Error(n)}}function Qe(){try{J.value=!0,b.value=[255,0,0,255,0,85,170,255,0,255,0,85,170,255],Z.value=!1,e.contourFilterLineLeft=null,e.contourFilterLineRight=null,e.rectXmin=null,e.rectYmin=null,e.rectXmax=null,e.rectYmax=null,k.value=3,oe(!1)}catch(t){throw console.log("taskToStep3()方法出错：",t),Error(t)}}function Ze(){try{oe(!1)}catch(t){console.log("onContourAlgorithmSwitchChange()方法出错：",t),E()}}function et(){try{oe(!0)}catch(t){console.log("onDetermineContour()方法出错：",t),E()}}function tt(){try{const t=ye.value*e.canvasScaling,n=g.value.width/2;t<n?e.contourFilterLineLeft=Math.ceil(t):e.contourFilterLineRight=Math.floor(t),Re(!0)}catch(t){throw console.log("chooseContourFilterLine()方法出错：",t),Error(t)}}function nt(){try{De(),Re(!0)}catch(t){throw console.log("chooseContourFilterLine()方法出错：",t),Error(t)}}function Re(t=!1){try{t===!0?e.ctx.putImageData(e.imageData,0,0):ue();const n=e.contourFilterLineLeft,o=e.contourFilterLineRight,l=g.value.height;if(n!==null&&(e.ctx.fillRect(0,0,n,l),e.ctx.beginPath(),e.ctx.moveTo(n,0),e.ctx.lineTo(n,l),e.ctx.stroke()),o!==null){const u=g.value.width;e.ctx.fillRect(o,0,u-o,l),e.ctx.beginPath(),e.ctx.moveTo(o,0),e.ctx.lineTo(o,l),e.ctx.stroke()}const i=e.rectXmin;if(i!==null){const u=e.rectYmin,h=e.rectXmax-i,d=e.rectYmax-u;e.ctx.fillRect(i,u,h,d),e.ctx.strokeRect(i,u,h,d)}}catch(n){throw console.log("drawContourFilter()方法出错：",n),Error(n)}}const ot=Ve(oe,500,!0);function oe(t=!1){try{if(k.value!==3)return;const n=b.value[0],o=b.value[1];let l=new e.cv.Mat;Z.value===!0?e.cv.threshold(e.matGray,l,n,255,e.cv.THRESH_BINARY):e.cv.Canny(e.matGray,l,o,n,3,!1),lt(l,t),l.delete()}catch(n){throw console.log("slideContour()方法出错：",n),Error(n)}}function lt(t,n=!1){try{let o=new e.cv.MatVector,l=new e.cv.Mat;if(e.cv.findContours(t,o,l,e.cv.RETR_LIST,e.cv.CHAIN_APPROX_NONE),n===!1){let i=new e.cv.Mat;e.matGray.copyTo(i);const u=new e.cv.Scalar(255),h=2*e.canvasScaling;e.cv.drawContours(i,o,-1,u,h,void 0,l,void 0),e.cv.imshow(g.value,i),i.delete(),e.imageData=e.ctx.getImageData(0,0,g.value.width,g.value.height),Re(!1)}else at(o),ct();l.delete(),o.delete()}catch(o){throw console.log("makeContour()方法出错：",o),Error(o)}}function at(t){try{M.loading(r.value.ContourFitLoadingContent);const n=[],o=g.value.width,l=g.value.height,i=e.contourFilterLineLeft,u=e.contourFilterLineRight,h=.01,d=i||Math.ceil(o*h),p=Math.ceil(l*h),x=u||Math.floor(o*(1-h)),a=Math.floor(l*(1-h)),C=e.rectXmin||x,V=e.rectYmin||a,D=e.rectXmax||d,G=e.rectYmax||p;for(let Y=0;Y<t.size();Y++){let H=t.get(Y);e:for(let B=0;B<H.rows;B++){const F=H.data32S[B*2],I=H.data32S[B*2+1];if(F<=d||I<=p||F>=x||I>=a)continue e;(F<C||F>D||I<V||I>G)&&n.push([F,I])}H.delete()}if(n.length<=6)throw M.loading(!1),M.message({type:"error",content:r.value.ContourFitErrorContent,duration:1e4}),Error(r.value.ContourFitErrorContent);rt(n),M.loading(!1)}catch(n){throw console.log("initializeContourPointSet()方法出错：",n),M.loading(!1),Error(n)}}function rt(t){try{let d=.2;const p=t,x=[];let a=null,C=!1,V=0,D={},G=[0,0];for(;!C&&V<100;){let fe=function([f,N],Q,A,_,be){const Se=f-ae,Ne=N-re,Xe=Se*ve-Ne*K,Ye=Se*K+Ne*ve,Te=Math.sqrt(Xe**2+Ye**2),He=Math.atan2(Ye,Xe),Pe=(de/((te*Math.cos(He))**2+(ee*Math.sin(He))**2))**.5;return Te<Pe*_||Te>Pe*be?A.push([f,N]):(Q.push([f,N]),G[1]<N&&(G=[f,N])),[Te,Pe]};V=V+1;let Y=new e.cv.matFromArray(p.length,1,e.cv.CV_32SC2,p.flat());D=e.cv.fitEllipseAMS(Y),Y.delete(),Y=null;const H=[],B=[],F=[],I=[],j=[];let $=0;const ee=D.size.width,te=D.size.height,de=ee**2*te**2/4,ae=D.center.x,re=D.center.y,me=-D.angle,K=Math.sin(me*Math.PI/180),ve=Math.cos(me*Math.PI/180),Le=1+d,ke=1-d;for(let f=0;f<p.length;f++){const[N,Q]=fe(p[f],H,B,ke,Le);j.push([N,Q]),$=$+N}const xe=1+d*.7,Me=1-d*.7;for(let f=0;f<x.length;f++)fe(x[f],I,F,Me,xe);const pe=j.length,Ce=$/pe;let T=0,P=0;for(let f=0;f<pe;f++){const N=j[f][0],Q=j[f][1];T=T+(Q-Ce)**2,P=P+(N-Ce)**2}a=T/P,B.length===0&&I.length===0?a>=.99||d<.001?C=!0:d=d*.7:(p.length=0,p.push(...H,...I),x.length=0,x.push(...B,...F)),C===!1&&p.length<=5&&(C=!0,M.dialog(r.value.ContourFitIterationErrorContent))}it(D),e.ellipseR2=a,e.ellipseObj=D,e.baselinePoint=G}catch(n){throw console.log("ellipsePointIterate()方法出错：",n),Error(n)}}function it(t){try{let n=new e.cv.Mat;e.matGray.copyTo(n);const o=new e.cv.Scalar(255),l=2*e.canvasScaling,i=t.size,u=new e.cv.Size(i.width*.5,i.height*.5);e.cv.ellipse(n,t.center,u,t.angle,0,360,o,l,e.cv.LINE_AA),e.cv.imshow(g.value,n),e.imageData=e.ctx.getImageData(0,0,g.value.width,g.value.height),n.delete()}catch(n){throw console.log("drawEllipse()方法出错：",n),Error(n)}}function st(){try{if(J.value===!1){const t=[b.value[0],b.value[1],0,255,0,85,170,255,0,255,0,85,170,255];b.value=t,J.value=!0}else Be(),J.value=!1}catch(t){throw console.log("contourCoarseToggle()方法出错：",t),Error(t)}}function Be(){try{const t=b.value[0],n=b.value[1],o=Math.max(0,Math.min(243,t-6)),l=Math.max(0,Math.min(243,n-6)),i=[t,n,o,o+12,o,o+4,o+8,o+12,l,l+12,l,l+4,l+8,l+12];b.value=i}catch(t){throw console.log("refreshContourFineSlider()方法出错：",t),Error(t)}}function ct(){try{ue(),ut(),Fe(),k.value=4}catch(t){throw console.log("taskToStep4()方法出错：",t),Error(t)}}function ut(){try{const t=e.ellipseObj.angle,n=e.baselinePoint,o=g.value.width,l=g.value.height,i=t%90,u=i<=45?i:i-90,h=Math.tan(u*Math.PI/180),d=h*(0-n[0])+n[1],p=h*(o-n[0])+n[1],x=l-d,a=l-p;le(x,a)}catch(t){throw console.log("taskToStep4()方法出错：",t),Error(t)}}function le(t,n){try{const o=t?Math.floor(t):S.value[0],l=n?Math.floor(n):S.value[1],i=g.value.height,u=Math.max(Math.floor(i/90),1),h=o-u*3,d=l-u*3,p=[o,l,h,h+u*6,h,h+u*2,h+u*4,h+u*6,d,d+u*6,d,d+u*2,d+u*4,d+u*6];S.value=p}catch(o){throw console.log("refreshBaselineFineSlider()方法出错：",o),Error(o)}}function ht(){try{const t=ye.value*e.canvasScaling,n=_e.value*e.canvasScaling,o=g.value.width,i=g.value.height-n,u=S.value[0],h=S.value[1];if(t<o*.35){const d=o/(o-t)*(i-h)+h;le(d,h)}else if(t>o*.65){const d=o/t*(i-u)+u;le(u,d)}else{const d=(h-u)/o*t+u,p=i-d,x=u+p,a=h+p;le(x,a)}}catch(t){throw console.log("chooseBaseline()方法出错：",t),Error(t)}}const gt=Ve(Fe,200,!0);function Fe(){try{const t=S.value[0],n=S.value[1],o=g.value.width,l=g.value.height,i=l-t,u=l-n;e.ctx.putImageData(e.imageData,0,0),e.ctx.beginPath(),e.ctx.moveTo(0,i),e.ctx.lineTo(o,u),e.ctx.stroke()}catch(t){throw console.log("drawBaseline()方法出错：",t),Error(t)}}function dt(){try{k.value=3,oe(!1)}catch(t){throw console.log("onBackToStep3()方法出错：",t),Error(t)}}function mt(){try{const t=vt(e.ellipseObj);M.dialog(r.value.ResultDialogContent[0]+t.toFixed(2)+r.value.ResultDialogContent[1])}catch(t){console.log("onDetermineBaseline()方法出错：",t),E()}}function vt(){try{const t=e.ellipseObj,n=t.center.x,o=t.center.y,l=-t.angle,i=Math.sin(l*Math.PI/180),u=Math.cos(l*Math.PI/180),h=g.value.height,d=0,p=h-S.value[0],x=g.value.width,a=h-S.value[1],C=Math.atan2(a-p,x-d)*180/Math.PI*-1,V=d-n,D=p-o,G=x-n,Y=a-o,H=V*u-D*i,B=V*i+D*u,F=G*u-Y*i,I=G*i+Y*u,j=t.size.width,$=t.size.height,ee=F-H,te=I-B,de=F*B-H*I,ae=te**2-(2*de/j)**2,re=-2*ee*te,me=ee**2-(2*de/$)**2,K=re**2-4*ae*me;if(K<=0)throw console.log("方程没有2个解，delta: ",K),M.message({type:"error",content:r.value.ContactErrorMessageContent,duration:1e4}),Error("方程没有2个解");{const ve=(-re+Math.sqrt(K))/(2*ae),Le=(-re-Math.sqrt(K))/(2*ae),ke=-ve*($/j)**2,fe=-Le*($/j)**2,xe=te/ee,Me=Math.atan(ke)*180/Math.PI,pe=Math.atan(fe)*180/Math.PI,Ce=Math.atan(xe)*180/Math.PI;let T=(Me-l)%180;T>90?T=T-180:T<=-90&&(T=T+180);let P=(pe-l)%180;P>90?P=P-180:P<=-90&&(P=P+180);let f=(Ce-l)%180;f>90?f=f-180:f<=-90&&(f=f+180);const Q=(a-p)/x*n+p>o;let A,_;Q?T>P?(A=180-(T-f),_=180+(P-f)):(A=180-(P-f),_=180+(T-f)):T>P?(A=-(P-f),_=T-f):(A=-(T-f),_=P-f),A<0&&(A=A+180),_<0&&(_=_+180),A>180&&(A=A-180),_>180&&(_=_-180);const be=(A+_)/2,Se=Math.abs(A-_);return O.value.push([e.filename,be,Se,A,_,C,e.ellipseR2]),localStorage.setItem("contactAngleResult",JSON.stringify(O.value)),be}}catch(t){throw console.log("calculateContactAngle()方法出错：",t),Error(t)}}function ft(t){try{M.dialog({theme:"danger",body:r.value.DeleteUniResultDialogContent,confirmBtn:r.value.DeleteResultDialogConfirmBtnLabel,cancelBtn:r.value.DeleteResultDialogCancelBtnLabel,onConfirmCallBack:()=>{O.value.splice(t,1),localStorage.setItem("contactAngleResult",JSON.stringify(O.value)),M.message(r.value.DeleteUniResultMessageContent)}})}catch(n){console.log("deleteUniResult()方法出错：",n),E()}}function pt(){try{M.dialog({theme:"danger",body:r.value.DeleteAllResultDialogContent,confirmBtn:r.value.DeleteResultDialogConfirmBtnLabel,cancelBtn:r.value.DeleteResultDialogCancelBtnLabel,onConfirmCallBack:()=>{O.value.length=0,localStorage.removeItem("contactAngleResult"),M.message(r.value.DeleteUniResultMessageContent)}})}catch(t){console.log("deleteUniResult()方法出错：",t),E()}}function Ct(){try{const t=[[...r.value.ResultTableContent]],n=O.value;for(let i=0;i<n.length;i++){const u=[i+1,...n[i]];t.push(u)}const o=new Map;o.set(r.value.ResultSheetLabel,t);const l=Et(o);Dt(l,"contact-angle_data.xlsx")}catch(t){console.log("downloadResult()方法出错：",t),E()}}return(t,n)=>{const o=It,l=Bt,i=we("MySwitch"),u=we("mySpace"),h=we("myButton"),d=Ft,p=Nt,x=we("MySpace");return v(),W(x,null,{default:L(()=>[R(o,{theme:"info",title:r.value.FunctionIntroductionTitle},{default:L(()=>[(v(!0),y(U,null,z(r.value.FunctionIntroductionContent,(a,C)=>(v(),y("div",{key:C},m(a),1))),128))]),_:1},8,["title"]),k.value===1?(v(),W(o,{key:0,theme:"warning",title:r.value.SetpTitle+"1"},{default:L(()=>[(v(!0),y(U,null,z(r.value.Setp1Content,(a,C)=>(v(),y("div",{key:C},m(a),1))),128))]),_:1},8,["title"])):ie("",!0),R(l,{disabled:!1,class:"center",theme:"image",multiple:!1,draggable:!1,showImageFileName:!0,abridgeName:[3,8],files:Ae.value,"onUpdate:files":n[0]||(n[0]=a=>Ae.value=a),autoUpload:!1,sizeLimit:{size:10,unit:"MB"},onChange:je},null,8,["files"]),k.value===2?(v(),W(o,{key:1,theme:"warning",title:r.value.SetpTitle+"2"},{default:L(()=>[(v(!0),y(U,null,z(r.value.Setp2Content,(a,C)=>(v(),y("div",{key:C},m(a),1))),128))]),_:1},8,["title"])):k.value===3?(v(),W(u,{key:2},{default:L(()=>[R(o,{theme:"warning",title:r.value.SetpTitle+"3"},{default:L(()=>[(v(!0),y(U,null,z(r.value.Setp3Content,(a,C)=>(v(),y("div",{key:C},m(a),1))),128))]),_:1},8,["title"]),R(o,{theme:"info",title:r.value.ContourAlgorithmTitle},{default:L(()=>[(v(!0),y(U,null,z(r.value.ContourAlgorithmContent,(a,C)=>(v(),y("div",{key:C},[a.strong?(v(),y("div",Xt,[w("strong",null,m(a.strong),1),X(m(a.normal),1)])):(v(),y("div",Yt,m(a),1))]))),128))]),_:1},8,["title"]),R(i,{onChange:Ze,modelValue:Z.value,"onUpdate:modelValue":n[1]||(n[1]=a=>Z.value=a),leftLabel:r.value.CannyAlgorithmLabel,rightLabel:r.value.ThresholdingMethodLabel},null,8,["modelValue","leftLabel","rightLabel"]),R(o,{theme:"info",title:r.value.ContourMaskTitle},{default:L(()=>[(v(!0),y(U,null,z(r.value.ContourMaskContent,(a,C)=>(v(),y("div",{key:C},[a.strong?(v(),y("div",Ht,[w("strong",null,m(a.strong),1),X(m(a.normal),1)])):(v(),y("div",Ot,m(a),1))]))),128))]),_:1},8,["title"]),R(i,{modelValue:se.value,"onUpdate:modelValue":n[2]||(n[2]=a=>se.value=a),leftLabel:r.value.ContourMaskSideLabel,rightLabel:r.value.ContourMaskCentralLabel},null,8,["modelValue","leftLabel","rightLabel"])]),_:1})):k.value===4?(v(),W(o,{key:3,theme:"warning",title:r.value.SetpTitle+"4"},{default:L(()=>[(v(!0),y(U,null,z(r.value.Setp4Content,(a,C)=>(v(),y("div",{key:C},m(a),1))),128))]),_:1},8,["title"])):ie("",!0),w("div",Vt,[kt(w("canvas",{ref_key:"canvasRef",ref:g,onClick:ze},null,512),[[xt,k.value>=2]])]),k.value===2?(v(),y("div",Wt,[R(h,{onClick:$e,block:!1},{default:L(()=>[X(m(r.value.CutPictureButtonText),1)]),_:1}),R(h,{onClick:Ke,block:!1,theme:"danger"},{default:L(()=>[X(m(r.value.CutPictureCompleteButtonText),1)]),_:1})])):k.value===3?(v(),W(u,{key:5,size:"small"},{default:L(()=>[Z.value===!1?(v(),y("div",Ut,m(r.value.ContourSliderMainParameterChangeLabel),1)):(v(),y("div",zt,m(r.value.ContourSliderMainParameterValueLabel),1)),R(d,{onChange:he,onChangeEnd:ge,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:b.value[2],max:b.value[3],step:1,marks:[b.value[4],b.value[5],b.value[6],b.value[7]],modelValue:b.value[0],"onUpdate:modelValue":n[3]||(n[3]=a=>b.value[0]=a)},null,8,["min","max","marks","modelValue"]),R(p),Z.value===!1?(v(),W(u,{key:2,size:"small"},{default:L(()=>[w("div",null,m(r.value.ContourSliderAuxiliaryParameterLabel),1),R(d,{onChange:he,onChangeEnd:ge,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:b.value[8],max:b.value[9],step:1,marks:[b.value[10],b.value[11],b.value[12],b.value[13]],modelValue:b.value[1],"onUpdate:modelValue":n[4]||(n[4]=a=>b.value[1]=a)},null,8,["min","max","marks","modelValue"]),R(p)]),_:1})):ie("",!0),w("div",Gt,[R(h,{onClick:st,block:!1,theme:J.value?"primary":"warning"},{default:L(()=>[X(m(J.value?r.value.ContourSliderSwitchFineButtonLabel:r.value.ContourSliderSwitchCoarseButtonLabel),1)]),_:1},8,["theme"]),R(h,{onClick:et,block:!1,theme:"danger"},{default:L(()=>[X(m(r.value.ContourDetermineButtonLabel),1)]),_:1})])]),_:1})):k.value===4?(v(),W(u,{key:6,size:"small"},{default:L(()=>[w("div",null,m(r.value.InterceptLeftSliderLabel),1),R(d,{onChange:he,onChangeEnd:ge,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:S.value[2],max:S.value[3],step:1,marks:[S.value[4],S.value[5],S.value[6],S.value[7]],modelValue:S.value[0],"onUpdate:modelValue":n[5]||(n[5]=a=>S.value[0]=a)},null,8,["min","max","marks","modelValue"]),R(p),w("div",null,m(r.value.InterceptRightSliderLabel),1),R(d,{onChange:he,onChangeEnd:ge,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:S.value[8],max:S.value[9],step:1,marks:[S.value[10],S.value[11],S.value[12],S.value[13]],modelValue:S.value[1],"onUpdate:modelValue":n[6]||(n[6]=a=>S.value[1]=a)},null,8,["min","max","marks","modelValue"]),R(p),w("div",jt,[R(h,{onClick:dt,block:!1,theme:"default"},{default:L(()=>[X(m(r.value.StepBackButtonLabel),1)]),_:1}),R(h,{onClick:mt,block:!1,theme:"primary"},{default:L(()=>[X(m(r.value.BaselineConfirmButtonLabel),1)]),_:1})])]),_:1})):ie("",!0),O.value[0]?(v(),W(u,{key:7,size:"small"},{default:L(()=>[w("div",qt,[w("table",null,[w("thead",null,[w("tr",null,[(v(!0),y(U,null,z(r.value.ResultTableContent,(a,C)=>(v(),y("th",{key:C},m(a),1))),128)),w("th",null,m(r.value.ResultTableProcessingLabel),1)])]),w("tbody",null,[(v(!0),y(U,null,z(O.value,(a,C)=>(v(),y("tr",{key:C},[w("td",null,m(C+1),1),w("td",null,m(a[0]),1),w("td",null,m(a[1].toFixed(2)),1),w("td",null,m(a[2].toFixed(2)),1),w("td",null,m(a[3].toFixed(2)),1),w("td",null,m(a[4].toFixed(2)),1),w("td",null,m(a[6]?a[5].toFixed(2):"旧版数据请尽快清理"),1),w("td",null,m(a[6]?a[6].toFixed(4):a[5].toFixed(4)),1),w("td",null,[R(h,{onClick:V=>ft(C),block:!1,theme:"danger"},{default:L(()=>[X(m(r.value.ResultTableDeleteButtonLabel),1)]),_:1},8,["onClick"])])]))),128))])])]),w("div",Jt,[R(h,{onClick:Ct,block:!1,theme:"primary"},{default:L(()=>[X(m(r.value.ResultTableExportButtonLabel),1)]),_:1}),R(h,{onClick:pt,block:!1,theme:"danger"},{default:L(()=>[X(m(r.value.DeleteAllResultButtonLabel),1)]),_:1})])]),_:1})):ie("",!0)]),_:1})}}},on=bt($t,[["__scopeId","data-v-6b6f20bc"]]);export{on as default};
