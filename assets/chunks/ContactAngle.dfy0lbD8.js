import{_ as de,p as k,q as ve,C as A,b as M,o as _,w as h,G as v,e as N,j as p,c as fe,a as f,ac as ge,ad as he,t as pe,V as ye}from"./framework.CjnDDKZX.js";import{u as xe,a as Ce,o as _e,b as z}from"./index.D1Z3afjH.js";import{L as we,M as Se,D as ke,A as Me,U as Pe,S as Ye,a as Ie}from"./theme.BJZiRR4s.js";const P={loadingInstance:null,dialogInstance:null};function be(g="加载中..."){P.loadingInstance&&P.loadingInstance.hide(),g!==!1&&(P.loadingInstance=we({delay:0,fullscreen:!0,indicator:!0,inheritColor:!1,loading:!0,preventScrollThrough:!0,showOverlay:!0,size:"large",text:g,zIndex:3500}))}function Re(g){P.dialogInstance&&P.dialogInstance.destroy(),typeof g=="string"&&(g={body:g});const{theme:m="info",header:Y,body:i,confirmBtn:w,onConfirm:s=()=>{}}=g,I=g.onConfirm?g.cancelBtn||void 0:null;P.dialogInstance=ke({mode:"modal",placement:"center",theme:m,closeBtn:!1,destroyOnClose:!0,header:Y,body:i,footer:!0,confirmBtn:w,confirmLoading:!1,confirmOnEnter:!0,cancelBtn:I,onConfirm:()=>{s(),P.dialogInstance.destroy()}})}function Xe(g){typeof g=="string"&&(g={content:g});const{theme:m="info",content:Y,duration:i=1500}=g;Se(m,{closeBtn:!0,content:Y,icon:!0,placement:"center"},i)}const y={loading:be,dialog:Re,message:Xe},Ae={style:{width:"100%"}},De={key:4,class:"center"},Ee={class:"center"},Be={class:"center"},Ge={__name:"ContactAngle",setup(g){y.loading("正在启动OpenCV.js计算机视觉模块，请稍候...");const m=k(1),Y=k([]),i=k(null),w=xe(i),s=k([0,0,0,255,0,85,170,255,0,255,0,85,170,255]),I=k(!1),S=k(!0),c=k([0,0]),e={cv:null,ctx:null,canvasScaling:0,matGray:null,imageDataGray:null,rectXmax:null,rectYmax:null,rectXmin:null,rectYmin:null,imageDataContour:null,contourPointAoa:[],contourYMin:null},{elementX:T,elementY:V}=Ce(i);_e(i,O);const{stop:W}=ve([i,w],n=>{const[t,a]=n;t&&a&&(W(),i.value.style.width=w.value.clientWidth+"px",ye(()=>import("./opencv.DUTv8PWl.js").then(o=>o.o),[]).then(o=>{o.default.then(r=>{e.cv=r,y.loading(!1)})}))});function O(n){const t=m.value;t===2?(D(),e.ctx.putImageData(e.imageDataGray,0,0)):t===3&&e.ctx.putImageData(e.imageDataGray,0,0)}function F(n){const t=m.value;t===2?K():t===4&&ie()}function D(){e.rectXmax=null,e.rectYmax=null,e.rectXmin=null,e.rectYmin=null}function E(){e.ctx.strokeStyle="red",e.ctx.lineWidth=2*e.canvasScaling}function b(n){const t=m.value;t===3?ne(!1):t===4&&se()}function L(n){m.value===3&&S.value===!1&&U()}function $(){m.value=1}async function q(n){var t;try{if(n.length===0){$();return}y.loading("正在读取照片...");const a=URL.createObjectURL(n[0].raw),l=new Image;l.style.display="none",l.src=a,await l.decode(),e.canvasScaling=l.naturalWidth/w.value.clientWidth,i.value.style.height=l.naturalHeight/e.canvasScaling+"px";const o=e.cv.imread(l);l.remove(),(t=e.matGray)!=null&&t.delete&&e.matGray.delete(),e.matGray=new e.cv.Mat,e.cv.cvtColor(o,e.matGray,e.cv.COLOR_RGBA2GRAY,0),e.cv.imshow(i.value,e.matGray),o.delete(),e.ctx=i.value.getContext("2d"),E(),e.imageDataGray=e.ctx.getImageData(0,0,i.value.width,i.value.height),J(),y.loading(!1)}catch(a){y.loading(!1),console.log("onPicChange()方法出错：",a),y.dialog({theme:"danger",header:"读取照片报错",body:a.message})}}function J(){m.value=2}function K(){try{const n=T.value*e.canvasScaling,t=V.value*e.canvasScaling;if(!e.rectXmax){const u=i.value.width,d=i.value.height,C=Math.min(u/4,d/4),X=C*2/3;e.rectXmax=Math.min(n+C,u),e.rectYmax=Math.min(t+X,d),e.rectXmin=Math.max(n-C,0),e.rectYmin=Math.max(t-X,0),B();return}if(n===e.rectXmax||n===e.rectXmin||t===e.rectYmax||t===e.rectYmin)return;let a=0;if(n>e.rectXmax?e.rectXmax=n:n<e.rectXmin?e.rectXmin=n:a++,t>e.rectYmax?e.rectYmax=t:t<e.rectYmin?e.rectYmin=t:a++,a!==2){B();return}const l=(e.rectYmax-e.rectYmin)/(e.rectXmax-e.rectXmin),o=(t-e.rectYmin)/(n-e.rectXmin),r=(t-e.rectYmin)/(n-e.rectXmax);o>=l?r<=-l?e.rectYmax=t:e.rectXmin=n:r<=-l?e.rectXmax=n:e.rectYmin=t,B();return}catch(n){console.log("chooseRect()方法出错：",n),y.dialog({theme:"danger",header:"选框报错",body:n.message})}}function B(){e.ctx.putImageData(e.imageDataGray,0,0),e.ctx.strokeRect(e.rectXmin,e.rectYmin,e.rectXmax-e.rectXmin,e.rectYmax-e.rectYmin)}function Q(n){H(!1)}function Z(n){H(!0)}function H(n=!1){try{if(!e.rectXmax){n===!0&&(D(),m.value=3);return}const t=e.rectXmax-e.rectXmin,a=e.rectYmax-e.rectYmin,l=new e.cv.Rect(e.rectXmin,e.rectYmin,t,a);D();let o=e.matGray.roi(l);e.cv.imshow(i.value,o),e.matGray.delete(),e.matGray=o,o=null,i.value.style.width=w.value.clientWidth+"px",e.canvasScaling=t/w.value.clientWidth,i.value.style.height=a/e.canvasScaling+"px",E(),e.imageDataGray=e.ctx.getImageData(0,0,i.value.width,i.value.height),n&&j()}catch(t){console.log("sureRect()方法出错：",t),y.dialog({theme:"danger",header:"裁剪报错",body:t.message})}}function j(){S.value=!0,s.value=[0,0,0,255,0,85,170,255,0,255,0,85,170,255],I.value=!1,m.value=3}function ee(n){G(!1)}function te(n){G(!0)}const ne=z(G,500,!0);function G(n=!1){try{if(m.value!==3)return;const t=s.value[0],a=s.value[1];let l=new e.cv.Mat;I.value===!0?e.cv.threshold(e.matGray,l,t,a,e.cv.THRESH_BINARY):e.cv.Canny(e.matGray,l,a,t,3,!1),ae(l,n),l.delete()}catch(t){console.log("slideContour()方法出错：",t),y.dialog({theme:"danger",header:"轮廓查找操作报错",body:t.message})}}function ae(n,t=!1){try{let a=new e.cv.MatVector,l=new e.cv.Mat;e.cv.findContours(n,a,l,e.cv.RETR_LIST,e.cv.CHAIN_APPROX_NONE);let o=new e.cv.Mat;e.matGray.copyTo(o);const r=new e.cv.Scalar(255),u=2*e.canvasScaling;e.cv.drawContours(o,a,-1,r,u,void 0,l,void 0),e.cv.imshow(i.value,o),t===!0&&(le(a),e.imageDataContour=e.ctx.getImageData(0,0,i.value.width,i.value.height),re()),a.delete(),l.delete(),o.delete()}catch(a){throw console.log("makeContour()方法出错：",a),Error(a)}}function le(n){try{y.loading("正在存储轮廓坐标...");const t=[];let a=i.value.height;for(let l=0;l<n.size();l++){const o=n.get(l);for(let r=0;r<o.rows;r++){const u=o.data32S[r*2],d=o.data32S[r*2+1];t.push([u,d]),d<a&&(a=d)}o.delete()}e.contourPointAoa=t,e.contourYMin=a,y.loading(!1)}catch(t){throw y.loading(!1),console.log("contourPointsToAoa()方法出错：",t),Error(t)}}function oe(){if(S.value===!1){const n=[s.value[0],s.value[1],0,255,0,85,170,255,0,255,0,85,170,255];s.value=n,S.value=!0}else U(),S.value=!1}function U(){try{const n=s.value[0],t=s.value[1],a=Math.max(0,Math.min(243,n-6)),l=Math.max(0,Math.min(243,t-6)),o=[n,t,a,a+12,a,a+4,a+8,a+12,l,l+12,l,l+4,l+8,l+12];s.value=o}catch(n){throw Error(n)}}function re(){const n=e.contourYMin||0;E(),m.value=4,R(n,n)}function R(n,t){const a=n?Math.floor(n):c.value[0],l=t?Math.floor(t):c.value[1],o=i.value.height,r=Math.floor(o/90),u=Math.max(0,Math.min(o,a-r*3)),d=Math.max(0,Math.min(o,l-r*3)),C=[a,l,u,u+r*6,u,u+r*2,u+r*4,u+r*6,d,d+r*6,d,d+r*2,d+r*4,d+r*6];c.value=C}function ie(){const n=T.value*e.canvasScaling,t=V.value*e.canvasScaling,a=i.value.width,o=i.value.height-t;if(n<a*.35){const r=c.value[1],u=a/(a-n)*(o-r)+r;R(u,r)}else if(n>a*.65){const r=c.value[0],u=a/n*(o-r)+r;R(r,u)}else R(o,o)}const se=z(ce,200,!0);function ce(){const n=c.value[0],t=c.value[1],a=i.value.width,l=i.value.height,o=l-n,r=l-t;e.ctx.putImageData(e.imageDataContour,0,0),e.ctx.beginPath(),e.ctx.moveTo(0,o),e.ctx.lineTo(a,r),e.ctx.stroke()}function ue(n){m.value=3}function me(n){const t=c.value[0],a=c.value[1],o=`已成功获取液滴数据。
    轮廓数据点 ${e.contourPointAoa.length} 个。
    基线左、右截距分别为：${t} px，${a} px。
    后续功能敬请期待！`;y.dialog(o)}return(n,t)=>{const a=Me,l=Pe,o=A("MySwitch"),r=A("mySpace"),u=A("myButton"),d=Ye,C=Ie,X=A("MySpace");return _(),M(X,null,{default:h(()=>[v(a,{theme:"info",title:"功能简介"},{default:h(()=>t[6]||(t[6]=[f(" 1. 点击读取图片文件。读取的图片文件将直接灰度化。"),p("br",null,null,-1),f(" 2. 裁剪图片为合适的尺寸。短按控制边框；长按清空已有选框。"),p("br",null,null,-1),f(" 3. 选择基底线、液滴边缘线。 ")])),_:1,__:[6]}),m.value===1?(_(),M(a,{key:0,theme:"warning",title:"步骤1"},{default:h(()=>t[7]||(t[7]=[f(" 首先点击“点击上传图片”读取图片。"),p("br",null,null,-1),f(" 读取到的图片会自动进行灰度化渲染。 ")])),_:1,__:[7]})):N("",!0),v(l,{disabled:!1,class:"center",theme:"image",multiple:!1,draggable:!1,showImageFileName:!0,abridgeName:[3,8],files:Y.value,"onUpdate:files":t[0]||(t[0]=x=>Y.value=x),autoUpload:!1,sizeLimit:{size:10,unit:"MB"},onChange:q},null,8,["files"]),m.value===2?(_(),M(a,{key:1,theme:"warning",title:"步骤2"},{default:h(()=>t[8]||(t[8]=[f(" 接下来需要将图片裁剪为合适的尺寸。"),p("br",null,null,-1),f(" 短按可控制边框；长按可清空已有选框。"),p("br",null,null,-1),f(" 可通过下方“裁剪图片”按钮多次裁剪，直到满意后，点击下方“完成裁剪”按钮进入下一步。 ")])),_:1,__:[8]})):m.value===3?(_(),M(r,{key:2},{default:h(()=>[v(a,{theme:"warning",title:"步骤3"},{default:h(()=>t[9]||(t[9]=[f(" 接下来寻找固体基底及液滴的最佳轮廓。"),p("br",null,null,-1),f(" 调节滑轨可切换灰度值呈现的轮廓效果；长按可清空效果。 ")])),_:1,__:[9]}),v(o,{onChange:ee,modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=x=>I.value=x),leftLabel:"Canny法",rightLabel:"阈值化法"},null,8,["modelValue"])]),_:1})):m.value===4?(_(),M(a,{key:3,theme:"warning",title:"步骤4"},{default:h(()=>t[10]||(t[10]=[f(" 找基线 ")])),_:1,__:[10]})):N("",!0),p("div",Ae,[ge(p("canvas",{ref_key:"canvasRef",ref:i,onClick:F},null,512),[[he,m.value>=2]])]),m.value===2?(_(),fe("div",De,[v(u,{onClick:Q,block:!1},{default:h(()=>t[11]||(t[11]=[f(" 裁剪图片 ")])),_:1,__:[11]}),v(u,{onClick:Z,block:!1,theme:"danger"},{default:h(()=>t[12]||(t[12]=[f(" 完成裁剪 ")])),_:1,__:[12]})])):m.value===3?(_(),M(r,{key:5,size:"small"},{default:h(()=>[t[14]||(t[14]=p("div",null,"主参数（G色阶）：",-1)),v(d,{onChange:b,onChangeEnd:L,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:s.value[2],max:s.value[3],step:1,marks:[s.value[4],s.value[5],s.value[6],s.value[7]],modelValue:s.value[0],"onUpdate:modelValue":t[2]||(t[2]=x=>s.value[0]=x)},null,8,["min","max","marks","modelValue"]),v(C),t[15]||(t[15]=p("div",null,"辅助参数（G色阶）：",-1)),v(d,{onChange:b,onChangeEnd:L,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:s.value[8],max:s.value[9],step:1,marks:[s.value[10],s.value[11],s.value[12],s.value[13]],modelValue:s.value[1],"onUpdate:modelValue":t[3]||(t[3]=x=>s.value[1]=x)},null,8,["min","max","marks","modelValue"]),v(C),p("div",Ee,[v(u,{onClick:oe,block:!1,theme:S.value?"primary":"warning"},{default:h(()=>[f(pe(S.value?"切换细调":"切换粗调"),1)]),_:1},8,["theme"]),v(u,{onClick:te,disabled:s.value[0]===0,block:!1,theme:"danger"},{default:h(()=>t[13]||(t[13]=[f(" 确认轮廓 ")])),_:1,__:[13]},8,["disabled"])])]),_:1,__:[14,15]})):m.value===4?(_(),M(r,{key:6,size:"small"},{default:h(()=>[t[18]||(t[18]=p("div",null,"左截距（px）：",-1)),v(d,{onChange:b,onchangeEnd:null,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:c.value[2],max:c.value[3],step:1,marks:[c.value[4],c.value[5],c.value[6],c.value[7]],modelValue:c.value[0],"onUpdate:modelValue":t[4]||(t[4]=x=>c.value[0]=x)},null,8,["min","max","marks","modelValue"]),v(C),t[19]||(t[19]=p("div",null,"右截距（px）：",-1)),v(d,{onChange:b,onchangeEnd:null,inputNumberProps:!1,label:!0,layout:"horizontal",range:!1,min:c.value[8],max:c.value[9],step:1,marks:[c.value[10],c.value[11],c.value[12],c.value[13]],modelValue:c.value[1],"onUpdate:modelValue":t[5]||(t[5]=x=>c.value[1]=x)},null,8,["min","max","marks","modelValue"]),v(C),p("div",Be,[v(u,{onClick:ue,block:!1,theme:"default"},{default:h(()=>t[16]||(t[16]=[f(" 返回上一步 ")])),_:1,__:[16]}),v(u,{onClick:me,disabled:s.value[0]===0,block:!1,theme:"danger"},{default:h(()=>t[17]||(t[17]=[f(" 确认基线 ")])),_:1,__:[17]},8,["disabled"])])]),_:1,__:[18,19]})):N("",!0)]),_:1})}}},Le=de(Ge,[["__scopeId","data-v-f23169db"]]);export{Le as default};
