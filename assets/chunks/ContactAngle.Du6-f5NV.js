import{_ as yt,D as St,p as j,aw as At,v as kt,u as wt,q as De,P as Ce,$ as Pt,C as Le,b as Z,o as p,w as x,G as M,e as ve,j as T,c as y,F as ee,B as te,t as f,a as B,ac as Dt,ad as Lt}from"./framework.Cmgf5mhA.js";import{u as Et,m as g,o as _t,a as Xe}from"./myFunc.CcyIhVzs.js";import{l as Bt,a as It,d as Nt}from"./opencvLoader.DgbHoPgl.js";import{A as Ft,U as Ot,S as Vt,D as Ht,P as Gt}from"./theme.D-PvJmOe.js";const c={},u={},je={root:c,en:u};c.FunctionIntroductionTitle="功能简介";u.FunctionIntroductionTitle="Function Introduction";c.FunctionIntroductionContent=["1.  点击读取图片文件。","2.  裁剪图片为合适的尺寸。","3.  以椭圆拟合液滴边缘轮廓。","4.  微调基线，并计算得到接触角。"];u.FunctionIntroductionContent=["1.  Click to read the image file.","2.  Crop the image to the appropriate size.","3.  Fit the edge contour of the droplet with an ellipse.","4.  Fine-tune the baseline and calculate the contact angle."];c.SetpTitle="步骤";u.SetpTitle="Step ";c.Setp1Content=["首先点击“点击上传图片”读取图片。","读取到的图片会自动进行灰度化渲染。"];u.Setp1Content=["First click on the 'Click to upload image' to read the image.","The read image will be automatically rendered in grayscale."];c.Setp2Content=["接下来需要将图片裁剪为合适的尺寸。","点击/触控图片，短按可控制边框；长按可清空已有选框。","可通过下方“裁剪图片”按钮多次裁剪，直到满意后，点击下方“完成裁剪”按钮进入下一步。"];u.Setp2Content=["Next, you need to crop the image to the appropriate size.","Click/touch the image, short press to control the border; Long press to clear the existing selection box.","You can crop the image multiple times by clicking the 'Crop Image' button below, and click the 'Finish Cropping' button below to proceed to the next step after you are satisfied."];c.Setp3Content=["接下来寻找液滴的最佳轮廓。","调节滑轨可调整参数并查看轮廓效果；点击图片可设置遮罩，被遮罩的轮廓点将不会参与后续拟合。"];u.Setp3Content=["Next, find the best contour of the droplet.","Adjust the slider to adjust the parameters and view the contour effect; Click on the image to set the mask, the contour points that are masked will not participate in the subsequent fitting."];c.Setp4Content=["接下来寻找固体基底与液滴接触的“基线”。","点击/触控图片左、中、右侧以粗调基线位置；调节滑轨以细调。"];u.Setp4Content=["Next, find the baseline where the solid substrate and the droplet contact.","Click / touch the left, middle and right sides of the image to coarse tune the baseline position; Adjust the slider to fine tune."];c.ContourAlgorithmTitle="轮廓/边缘检测";u.ContourAlgorithmTitle="Contour / Edge Detection";c.ContourAlgorithmArr=["Canny算法","阈值化法"];u.ContourAlgorithmArr=["Canny Algorithm","Thresholding Method"];c.ContourAlgorithmContent=[{strong:"Canny算法",normal:"。是一种多阶段的边缘检测算法，由John F. Canny提出。其原理为计算图像中像素色阶变化的梯度及方向，得到“边缘”图案。然后通过给定的两个阈值参数以筛选出合适的轮廓。"},"主参数：亦称“高阈值”，所有色阶变化高于此参数的边缘，都将被认定为“轮廓”。","辅助参数：亦称“低阈值”，对于色阶变化小于“高阈值”、但与轮廓相连的边缘而言，若其色阶变化大于“低阈值”，则也将被认定为轮廓的一部分。以此确保轮廓的完整性。",{strong:"阈值化法",normal:"。是一种传统的二值化处理方法。其原理为将图像中的像素色阶值与所给定的阈值进行比较，大于阈值的像素值将被设定为“白色”，小于阈值的像素值将被设定为“黑色”。然后将黑白之间的边界线认定为轮廓。"},"主参数：亦称“阈值”，所有色阶值高于此参数的像素，都将被认定为“白色”。"];u.ContourAlgorithmContent=[{strong:"Canny Algorithm",normal:". is a multi-stage edge detection algorithm proposed by John F. Canny. Its principle is to calculate the gradient and direction of the color grade change of pixels in the image, and get the 'edge' pattern. Then, through the given two threshold parameters, the appropriate contour is filtered out."},"Main parameter: also known as 'high threshold', all edges with color grade changes higher than this parameter will be considered as 'contour'.","Auxiliary parameter: also known as 'low threshold', for edges with color grade changes less than 'high threshold' but connected to the contour, if its color grade change is greater than 'low threshold', it will also be considered as part of the contour. This ensures the integrity of the contour.",{strong:"Thresholding Method",normal:". is a traditional binary processing method. Its principle is to compare the color grade value of the pixel in the image with the given threshold, and pixels with color grade values greater than the threshold will be set to 'white', and pixels with color grade values less than the threshold will be set to 'black'. Then, the boundary line between black and white is regarded as the contour."},"Main parameter: also known as 'threshold', all pixels with color grade values higher than this parameter will be considered as 'white'."];c.ContourMaskTitle="遮罩";u.ContourMaskTitle="Contour Mask";c.ContourMaskContentArr=["基线遮罩","两边遮罩","中心遮罩"];u.ContourMaskContentArr=["Baseline","Sides","Central"];c.ContourMaskContent=[{strong:"基线遮罩",normal:"。用于去除轮廓基线及基线下方的误识别伪轮廓。可点集图片左、中、右侧以调整基线。"},{strong:"两边遮罩",normal:"。用于去除轮廓两边基线误识别的伪轮廓。可点击图片左部或右部设置遮罩。"},{strong:"中心遮罩",normal:"。用于去除轮廓中心因光源投影而产生的伪轮廓。可点击图片以调整边框。"},"被遮罩覆盖的轮廓点将不会参与后续拟合，长按图片可清空遮罩。"];u.ContourMaskContent=[{strong:"Baseline Masks",normal:". is used to remove the pseudo contour below the contour baseline. Click on the left, middle or right side of the image to set the mask."},{strong:"Side Masks",normal:". is used to remove the pseudo contour of the contour base line misrecognition on both sides of the contour. Click on the left or right side of the image to set the mask, the contour points that are masked will not participate in the subsequent fitting."},{strong:"Central Mask",normal:". is used to remove the pseudo contour of the contour center caused by the projection of the light source. Click on the image, short press to control the border; "},"Contour points covered by the mask will not participate in subsequent fitting. Long press the image to clear the mask."];c.CutPictureButtonText="裁剪图片";u.CutPictureButtonText="Cut Picture";c.CutPictureCompleteButtonText="裁剪完成";u.CutPictureCompleteButtonText="Complete Cut";c.ContourSliderMainParameterLabelArr=["主参数（G色阶变化）：","主参数（G色阶值）："];u.ContourSliderMainParameterLabelArr=["Main Parameter (G color grade change): ","Main Parameter (G color grade value): "];c.ContourSliderAuxiliaryParameterLabel="辅助参数（G色阶变化）：";u.ContourSliderAuxiliaryParameterLabel="Auxiliary Parameter (G color grade change): ";c.ContourSliderSwitchFineButtonLabel="切换细调";u.ContourSliderSwitchFineButtonLabel="Switch Fine Tuning";c.ContourSliderSwitchCoarseButtonLabel="切换粗调";u.ContourSliderSwitchCoarseButtonLabel="Switch Coarse Tuning";c.ContourDetermineButtonLabel="确认轮廓";u.ContourDetermineButtonLabel="Confirm Contour";c.InterceptLeftSliderLabel="【微调】左截距（px）：";u.InterceptLeftSliderLabel="【Fine Tuning】Left Intercept (px): ";c.InterceptRightSliderLabel="【微调】右截距（px）：";u.InterceptRightSliderLabel="【Fine Tuning】Right Intercept (px): ";c.StepBackButtonLabel="返回上一步";u.StepBackButtonLabel="Step Back";c.BaselineConfirmButtonLabel="确认基线";u.BaselineConfirmButtonLabel="Confirm Baseline";c.ResultTableContent=["序号","文件名","接触角 (°)","偏差 (°)","左接触角 (°)","右接触角 (°)","基线角度 (°)","椭圆拟合R²"];u.ResultTableContent=["No.","Filename","Contact Angle (°)","Deviation (°)","Left Contact Angle (°)","Right Contact Angle (°)","Baseline Angle (°)","Ellipse Fitting R²"];c.ResultTableProcessingLabel="处理";u.ResultTableProcessingLabel="Process";c.ResultTableDeleteButtonLabel="删除";u.ResultTableDeleteButtonLabel="Delete";c.ResultTableReverseButtonLabel="结果倒序";u.ResultTableReverseButtonLabel="Reverse Order";c.ResultTableNormalButtonLabel="结果正序";u.ResultTableNormalButtonLabel="Normal Order";c.ResultTableExportButtonLabel="下载结果";u.ResultTableExportButtonLabel="Download Result";c.DeleteAllResultButtonLabel="清空结果";u.DeleteAllResultButtonLabel="Clear Result";c.OpenCVLoadingContent="正在启动OpenCV.js计算机视觉模块，请稍候...";u.OpenCVLoadingContent="Starting OpenCV.js computer vision module, please wait...";c.ErrorDialogTitle="程序报错";u.ErrorDialogTitle="Program Error";c.ErrorDialogContent="欢迎向软件开发人员（13611580728 司承运）主动告知此bug，以便及时修复。";u.ErrorDialogContent="Welcome to inform the software development personnel (+8613611580728 SI_Cheng-Yun) of this bug actively so that it can be repaired in time. ";c.DataInitErrorContent="数据结构被破坏，错误数据已删除。";u.DataInitErrorContent="Data structure is broken, error data has been deleted.";c.PicLoadingContent="正在读取照片...";u.PicLoadingContent="Loading picture...";c.ContourFitLoadingContent="正在拟合液滴轮廓...";u.ContourFitLoadingContent="Fitting droplet contour...";c.ContourFitErrorContent="轮廓点数据不够，无法拟合。";u.ContourFitErrorContent="Not enough contour points data, cannot fit.";c.ContourFitIterationErrorContent="有效数据点不足，已强行停止迭代。请仔细权衡本次轮廓拟合结果！";u.ContourFitIterationErrorContent="Insufficient valid data points, iteration has been forcibly stopped. Please carefully weigh the contour fitting results this time!";c.ResultDialogContent=["本次所测得接触角为 ","° 。可调整参数多次测量，具体结果详见下方数据表格。"];u.ResultDialogContent=["The contact angle measured this time is ","° . You can adjust the parameters multiple times to measure, and the specific results can be seen in the data table below."];c.ContactErrorMessageContent="计算出错，拟合轮廓与基线无交点。";u.ContactErrorMessageContent="Calculation error, the fitted contour and baseline have no intersection.";c.ResultSheetLabel="接触角数据";u.ResultSheetLabel="Contact_Angle_Data";c.DeleteUniResultDialogContent="确定要删除该结果吗？";u.DeleteUniResultDialogContent="Are you sure you want to delete this result?";c.DeleteAllResultDialogContent="确定要删除全部结果吗？";u.DeleteAllResultDialogContent="Are you sure you want to delete all results?";c.DeleteResultDialogConfirmBtnLabel="确定";u.DeleteResultDialogConfirmBtnLabel="Confirm";c.DeleteResultDialogCancelBtnLabel="取消";u.DeleteResultDialogCancelBtnLabel="Cancel";c.DeleteUniResultMessageContent="删除成功！";u.DeleteUniResultMessageContent="Deleted successfully!";const Ut={key:0},zt={key:1},Yt={key:0},Wt={key:1},Xt={style:{width:"100%",overflow:"hidden"}},jt={key:4,class:"center"},qt={class:"center"},Jt={class:"center"},$t={class:"center"},Kt={class:"center"},Qt={__name:"ContactAngle",setup(Zt){const s=St(je.root),w=j(1),Ee=j([]),S=At("canvasRef"),_=j([]),_e=[[255,0,255,[0,85,170,255]],[0,0,255,[0,85,170,255]]],re=j(0),le=j(!0),be=j(0),V=j([]),ne=j([]),Ae=j(1),Me=j(!1),Re=j([]),d={cv:null,canvasStyleWidth:null,filename:null,ctx:null,canvasScaling:0,matGray:null,imageData:null,rect:{xMax:null,yMax:null,xMin:null,yMin:null},colLine:{left:null,right:null},baseline:{left:null,right:null},baselineReferencePoint:null,ellipseObj:null,ellipseR2:null},{elementX:ke,elementY:Be}=Et(S);kt(()=>{try{const e=wt().localeIndex.value;if(e!=="root"&&(s.value=je[e]),g.loading(s.value.OpenCVLoadingContent),window.addEventListener("beforeunload",Ie),qe(),De([ne,Ae,Me],Je,{immediate:!0,deep:2}),S.value)d.ctx=S.value.getContext("2d",{willReadFrequently:!0});else{const{stop:t}=De(S,n=>{n&&(t(),d.ctx=n.getContext("2d",{willReadFrequently:!0}))})}Bt().then(t=>{d.cv=t,g.loading(!1)}),De(w,$e),_t(S,Ke)}catch(e){g.error("onMounted()报错：",e,A)}});function qe(){const e=localStorage.getItem("contactAngleResult");if(!e)return;const t=JSON.parse(e);if(!n(t))return;for(const o of t){if(!n(o))return;o.length=7}ne.value=t;function n(o){return Array.isArray(o)?!0:(localStorage.removeItem("contactAngleResult"),g.message(s.value.DataInitErrorContent),!1)}}function Je([e,t,n]){const o=e.length;if(o===0){Re.value=[];return}const a=10,r=t*a,i=r-a,[h,m]=n?[Math.max(0,o-r),o-i]:[i,Math.min(o,r)],v=e.slice(h,m),b=[];for(let l=0;l<v.length;l++)b.push([h+l,...v[l]]);n&&b.reverse(),Re.value=b}function $e(){Ce(e).catch(t=>{g.error("nextTickFocusOnCanvas()报错：",t,A)});function e(){S.value.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}Pt(()=>{window.removeEventListener("beforeunload",Ie)});function Ie(e){e.preventDefault(),e.returnValue=!1}function A(e){g.dialog({theme:"danger",header:s.value.ErrorDialogTitle,body:s.value.ErrorDialogContent+e})}function Ke(){try{const e=w.value;(e===2||e===3)&&(xe(),d.ctx.putImageData(d.imageData,0,0))}catch(e){g.error("onCanvasLongPress()报错：",e,A)}}function Qe(){try{const e=w.value;if(e===2)Fe(),nt();else if(e===3)it();else if(e===4){Ue();const{baseline:t}=d;Se([t.left,t.right])}}catch(e){g.error("onCanvasClick()报错：",e,A)}}function xe(){const{rect:e,colLine:t,baseline:n}=d;e.xMax=null,e.yMax=null,e.xMin=null,e.yMin=null,t.left=null,t.right=null,n.left=null,n.right=null}function we(){const{ctx:e,canvasScaling:t}=d;e.strokeStyle="red",e.lineWidth=2*t,e.fillStyle="rgba(0, 0, 0, 0.7)"}function Te(){try{const e=w.value;e===3?He():e===4&&ft()}catch(e){g.error("onSliderChange()报错：",e,A)}}function ye(){try{const e=w.value;if(e===3&&le.value===!1)Ye();else if(e===4){const[[t],[n]]=V.value;Se([t,n],!1)}}catch(e){g.error("onSliderChangeEnd()报错：",e,A)}}function Ze(){w.value=1}async function et(e){try{if(e.length===0){Ze();return}g.loading(s.value.PicLoadingContent);const{cv:t,ctx:n,matGray:o}=d,a=S.value;d.filename=e[0].name;const r=URL.createObjectURL(e[0].raw),i=new Image;i.style.display="none",i.src=r,await i.decode();const h=t.imread(i);i.remove(),o!=null&&o.delete&&o.delete(),d.matGray=new t.Mat,t.cvtColor(h,d.matGray,t.COLOR_RGBA2GRAY,0),t.imshow(a,d.matGray),h.delete(),d.imageData=n.getImageData(0,0,a.width,a.height),tt(),g.loading(!1)}catch(t){g.loading(!1),g.error("onPicChange()报错：",t,A)}}function tt(){xe(),w.value=2,Ce(Ne).catch(e=>{g.error("taskToStep2().nextTick()报错：",e,A)})}function Ne(){const e=S.value;d.canvasStyleWidth=e.parentElement.clientWidth,e.style.width=e.parentElement.clientWidth+"px",d.canvasScaling=e.width/d.canvasStyleWidth,e.style.height=e.height/d.canvasScaling+"px",we()}function Fe(){const{canvasScaling:e,rect:t}=d,n=ke.value*e,o=Be.value*e;if(!t.xMax){const v=S.value,b=Math.min(v.width*.5*.5,v.height*.5*.5),l=b*2/3;t.xMax=Math.min(n+b,v.width),t.yMax=Math.min(o+l,v.height),t.xMin=Math.max(n-b,0),t.yMin=Math.max(o-l,0);return}if(n===t.xMax||n===t.xMin||o===t.yMax||o===t.yMin)return;let a=0;if(n>t.xMax?t.xMax=n:n<t.xMin?t.xMin=n:a++,o>t.yMax?t.yMax=o:o<t.yMin?t.yMin=o:a++,a!==2)return;const r=(t.yMax-t.yMin)/(t.xMax-t.xMin),i=(o-t.yMin)/(n-t.xMin),h=(o-t.yMin)/(n-t.xMax);i>=r?h<=-r?t.yMax=o:t.xMin=n:h<=-r?t.xMax=n:t.yMin=o}function nt(){const{ctx:e,imageData:t,rect:n}=d,o=S.value;e.putImageData(t,0,0),e.fillRect(0,0,o.width,o.height);const a=n.xMax-n.xMin,r=n.yMax-n.yMin;e.putImageData(t,0,0,n.xMin,n.yMin,a,r),e.strokeRect(n.xMin,n.yMin,a,r)}function Oe(e){try{const{cv:t,matGray:n,ctx:o,rect:a}=d,r=S.value;if(a.xMax){const i=new t.Rect(a.xMin,a.yMin,a.xMax-a.xMin,a.yMax-a.yMin);xe();const h=n.roi(i);t.imshow(r,h),n.delete(),d.matGray=h,Ne(),d.imageData=o.getImageData(0,0,r.width,r.height)}e===!0&&ot()}catch(t){g.error("onSureRect()报错：",t,A)}}function ot(){re.value=0,le.value=!0,be.value=0,Ve(),xe(),w.value=3,Ce(Pe).catch(e=>{g.error("taskToStep3().nextTick()报错：",e,A)})}function Ve(){const e=_.value;if(e.length===0)_.value=t(_e);else{const n=t(_e);for(let o=0;o<e.length;o++)n[o][0]=e[o][0];_.value=n}function t(n){const o=[];for(let a=0;a<n.length;a++)o.push([...n[a]]);return o}}function Pe(){if(w.value!==3)return;const[e,t]=Ge();at([e,t]),e.delete(),t.delete(),ze()}const He=Xe(Pe,500,!0);function Ge(){const{cv:e,matGray:t}=d,n=re.value,[[o],[a]]=_.value,r=new e.Mat;n===0?e.Canny(t,r,a,o,3,!1):e.threshold(t,r,o,255,e.THRESH_BINARY);const i=new e.MatVector,h=new e.Mat;return e.findContours(r,i,h,e.RETR_LIST,e.CHAIN_APPROX_NONE),r.delete(),[i,h]}function at([e,t]){const{cv:n,matGray:o,canvasScaling:a,ctx:r}=d,i=S.value,h=new n.Mat;o.copyTo(h);const m=new n.Scalar(255,255,255),v=2*a;n.drawContours(h,e,-1,m,v,void 0,t,void 0),n.imshow(i,h),we(),h.delete(),d.imageData=r.getImageData(0,0,i.width,i.height)}function lt(){try{He()}catch(e){g.error("onContourAlgorithmSwitch()报错：",e,A)}}function it(){const{ctx:e,imageData:t}=d,n=be.value;n===0?Ue():n===1?rt():Fe(),e.putImageData(t,0,0),ze()}function rt(){const{canvasScaling:e,colLine:t}=d,n=ke.value*e,o=S.value.width/2;n<o?t.left=Math.ceil(n):t.right=Math.floor(n)}function Ue(){const{canvasScaling:e,baseline:t}=d,n=S.value;let o=t.left??n.height,a=t.right??n.height;const r=ke.value*e,i=Be.value*e;if(r<n.width*.35)o=n.width/(n.width-r)*(i-a)+a;else if(r>n.width*.65)a=n.width/r*(i-o)+o;else{const h=(a-o)/n.width*r+o,m=i-h;o=o+m,a=a+m}t.left=o,t.right=a}function ze(){const{ctx:e,colLine:t,rect:n,baseline:o}=d,a=S.value;if(t.left!==null&&(e.fillRect(0,0,t.left,a.height),e.beginPath(),e.moveTo(t.left,0),e.lineTo(t.left,a.height),e.stroke()),t.right!==null&&(e.fillRect(t.right,0,a.width-t.right,a.height),e.beginPath(),e.moveTo(t.right,0),e.lineTo(t.right,a.height),e.stroke()),n.xMin!==null){const r=n.xMax-n.xMin,i=n.yMax-n.yMin;e.fillRect(n.xMin,n.yMin,r,i),e.strokeRect(n.xMin,n.yMin,r,i)}o.left!==null&&(e.beginPath(),e.moveTo(0,o.left),e.lineTo(a.width,o.right),e.lineTo(a.width,a.height),e.lineTo(0,a.height),e.closePath(),e.fill(),e.beginPath(),e.moveTo(0,o.left),e.lineTo(a.width,o.right),e.stroke())}function st(){try{le.value===!1?Ve():Ye(),le.value=!le.value}catch(e){g.error("onContourSliderCoarseFineToggle()报错：",e,A)}}function Ye(){const[[e],[t]]=_.value,n=Math.max(0,Math.min(243,e-6)),o=Math.max(0,Math.min(243,t-6)),a=[[e,n,n+12,[n,n+4,n+8,n+12]],[t,o,o+12,[o,o+4,o+8,o+12]]];_.value=a}function ct(){try{g.loading(s.value.ContourFitLoadingContent);const[e,t]=Ge();t.delete();const[n,o]=ut(e);e.delete(),ht(n,o),dt(),gt(),g.loading(!1)}catch(e){g.loading(!1),g.error("onDetermineContour()报错：",e,A)}}function ut(e){const{colLine:n,rect:o,baseline:a}=d,r=S.value,i=[],h=n.left??Math.ceil(r.width*.01),m=n.right??Math.floor(r.width*(1-.01)),v=Math.ceil(r.height*.01),b=Math.floor(r.height*(1-.01)),l=a.left??b,G=(a.right??b)-l,Y=G/r.width,U=o.xMin??m,W=o.yMin??b,I=o.xMax??h,X=o.yMax??v,K=[],z=r.width**2+G**2;for(let N=0;N<e.size();N++){const H=e.get(N);e:for(let F=0;F<H.rows;F++){const E=H.data32S[F*2],O=H.data32S[F*2+1];if(E<=h||E>=m||O<=v||(O-l)/E>Y)continue e;if(E<U||E>I||O<W||O>X){i.push([E,O]);const q=(r.width*(O-l)-G*E)**2,J=Math.sqrt(q/z);K.push(J)}}H.delete()}if(i.length<=6)throw Error(s.value.ContourFitErrorContent);return[i,K]}function ht(e,t){const{cv:m}=d;let v=.2;const b=e,l=[],R=t,G=[];let Y=null,U=!1,W=0,I={},X=[0,0];for(;!U&&W<100;){W=W+1;const z=new m.matFromArray(b.length,1,m.CV_32SC2,b.flat());I=m.fitEllipseAMS(z),z.delete();const N=[],H=[],F=[],E=[],O=[],oe=[],q=[],J=[],ae=[];let $=0;const se=I.size.width,ce=I.size.height,fe=se**2*ce**2/4,ue=I.center.x,he=I.center.y,ie=-I.angle,de=Math.sin(ie*Math.PI/180),ge=Math.cos(ie*Math.PI/180),D=[ce,se,fe,ue,he,de,ge];for(let C=0;C<b.length;C++){const[P,me]=K(b[C],v,R[C],1,N,H,O,oe,D);ae.push([P,me]),$=$+P}for(let C=0;C<l.length;C++)K(l[C],v*.7,G[C],.7,E,F,J,q,D);const L=ae.length,k=$/L;let pe=0,Q=0;for(let C=0;C<L;C++){const P=ae[C][0],me=ae[C][1];pe=pe+(me-k)**2,Q=Q+(P-k)**2}Y=pe/Q,H.length===0&&E.length===0?Y>=.99||v<.001?U=!0:v=v*.7:(b.length=0,b.push(...N,...E),l.length=0,l.push(...H,...F),R.length=0,R.push(...O,...J),G.length=0,G.push(...oe,...q)),U===!1&&b.length<=5&&(U=!0,g.dialog(s.value.ContourFitIterationErrorContent))}d.ellipseR2=Y,d.ellipseObj=I,d.baselineReferencePoint=X;function K([z,N],H,F,E,O,oe,q,J,[ae,$,se,ce,fe,ue,he]){const ie=z-ce,de=N-fe,ge=ie*he-de*ue,D=ie*ue+de*he,L=Math.sqrt(ge**2+D**2),k=Math.atan2(D,ge),Q=(se/((ae*Math.cos(k))**2+($*Math.sin(k))**2))**.5,C=Math.abs(L-Q);return C/Q>H||C>F/E?(oe.push([z,N]),J.push(F)):(O.push([z,N]),q.push(F),X[1]<N&&(X=[z,N])),[L,Q]}}function dt(){const{cv:e,matGray:t,canvasScaling:n,ctx:o,ellipseObj:a}=d,r=S.value,i=new e.Mat;t.copyTo(i);const h=new e.Scalar(255,255,255),m=2*n,v=new e.Size(a.size.width*.5,a.size.height*.5);e.ellipse(i,a.center,v,a.angle,0,360,h,m,e.LINE_AA),e.imshow(r,i),i.delete(),we(),d.imageData=o.getImageData(0,0,r.width,r.height)}function gt(){mt(),w.value=4,Ce(We).catch(e=>{g.error("taskToStep4().nextTick()报错：",e,A)})}function mt(){const{ellipseObj:e,baselineReferencePoint:t,baseline:n}=d,o=S.value;if(n.left===null){const a=e.angle%90,r=a<=45?a:a-90,i=Math.tan(r*Math.PI/180),h=i*(0-t[0])+t[1],m=i*(o.width-t[0])+t[1];Se([h,m])}else Se([n.left,n.right])}function We(){const{ctx:e,imageData:t}=d,[[n],[o]]=V.value,a=S.value,r=a.height-n,i=a.height-o;e.putImageData(t,0,0),e.beginPath(),e.moveTo(0,r),e.lineTo(a.width,i),e.stroke()}const ft=Xe(We,200,!0);function Se([e,t],n=!0){const o=S.value,a=Math.round(n?o.height-e:e),r=Math.round(n?o.height-t:t),i=Math.max(Math.floor(o.height/90),1),h=a-i*3,m=r-i*3,v=[[a,h,h+i*6,[h,h+i*2,h+i*4,h+i*6]],[r,m,m+i*6,[m,m+i*2,m+i*4,m+i*6]]];V.value=v}function pt(){try{w.value=3,Ce(Pe).catch(e=>{g.error("onBackToStep3().nextTick()报错：",e,A)})}catch(e){g.error("onBackToStep3()报错：",e,A)}}function Ct(){try{const e=vt();g.dialog(s.value.ResultDialogContent[0]+e.toFixed(2)+s.value.ResultDialogContent[1])}catch(e){g.error("onDetermineBaseline()报错：",e,A)}}function vt(){const e=d.ellipseObj,t=S.value,[[n],[o]]=V.value,a=e.center.x,r=e.center.y,i=-e.angle,h=Math.sin(i*Math.PI/180),m=Math.cos(i*Math.PI/180),v=0,b=t.height-n,l=t.width,R=t.height-o,G=Math.atan2(R-b,l-v)*180/Math.PI*-1,Y=v-a,U=b-r,W=l-a,I=R-r,X=Y*m-U*h,K=Y*h+U*m,z=W*m-I*h,N=W*h+I*m,H=e.size.width,F=e.size.height,E=z-X,O=N-K,oe=z*K-X*N,q=O**2-(2*oe/H)**2,J=-2*E*O,ae=E**2-(2*oe/F)**2,$=J**2-4*q*ae;if($<=0)throw console.log("方程没有2个解，delta: ",$),g.message({type:"error",content:s.value.ContactErrorMessageContent,duration:1e4}),Error("方程没有2个解");{const se=(-J+Math.sqrt($))/(2*q),ce=(-J-Math.sqrt($))/(2*q),fe=-se*(F/H)**2,ue=-ce*(F/H)**2,he=O/E,ie=Math.atan(fe)*180/Math.PI,de=Math.atan(ue)*180/Math.PI,ge=Math.atan(he)*180/Math.PI;let D=(ie-i)%180;D>90?D=D-180:D<=-90&&(D=D+180);let L=(de-i)%180;L>90?L=L-180:L<=-90&&(L=L+180);let k=(ge-i)%180;k>90?k=k-180:k<=-90&&(k=k+180);const Q=(R-b)/l*a+b>r;let C,P;Q?D>L?(C=180-(D-k),P=180+(L-k)):(C=180-(L-k),P=180+(D-k)):D>L?(C=-(L-k),P=D-k):(C=-(D-k),P=L-k),C<0&&(C=C+180),P<0&&(P=P+180),C>180&&(C=C-180),P>180&&(P=P-180);const me=(C+P)/2,Tt=Math.abs(C-P);return ne.value.push([d.filename,me,Tt,C,P,G,d.ellipseR2]),localStorage.setItem("contactAngleResult",JSON.stringify(ne.value)),me}}function bt(e){try{const t=ne.value;g.dialog({theme:"danger",body:s.value.DeleteUniResultDialogContent,confirmBtn:s.value.DeleteResultDialogConfirmBtnLabel,cancelBtn:s.value.DeleteResultDialogCancelBtnLabel,onConfirmCallBack:()=>{t.splice(e,1),localStorage.setItem("contactAngleResult",JSON.stringify(t)),g.message(s.value.DeleteUniResultMessageContent)}})}catch(t){g.error("onDeleteUniResult()报错：",t,A)}}function Mt(){try{const e=ne.value;g.dialog({theme:"danger",body:s.value.DeleteAllResultDialogContent,confirmBtn:s.value.DeleteResultDialogConfirmBtnLabel,cancelBtn:s.value.DeleteResultDialogCancelBtnLabel,onConfirmCallBack:()=>{e.length=0,localStorage.removeItem("contactAngleResult"),g.message(s.value.DeleteUniResultMessageContent)}})}catch(e){g.error("onDeleteAllResult()报错：",e,A)}}function Rt(){try{Me.value=!Me.value}catch(e){g.error("onReverseResultOrder()报错：",e,A)}}function xt(){try{const e=[[...s.value.ResultTableContent]],t=ne.value;for(let a=0;a<t.length;a++){const r=[a+1,...t[a]];e.push(r)}const n=new Map;n.set(s.value.ResultSheetLabel,e);const o=It(n);Nt(o,"contact-angle_data.xlsx")}catch(e){g.error("onDownloadResult()报错：",e,A)}}return(e,t)=>{const n=Ft,o=Ot,a=Le("MyRadio"),r=Le("MySpace"),i=Le("MyButton"),h=Vt,m=Ht,v=Gt;return p(),Z(r,null,{default:x(()=>{var b;return[M(n,{theme:"info",title:s.value.FunctionIntroductionTitle},{default:x(()=>[(p(!0),y(ee,null,te(s.value.FunctionIntroductionContent,(l,R)=>(p(),y("div",{key:R},f(l),1))),128))]),_:1},8,["title"]),w.value===1?(p(),Z(n,{key:0,theme:"warning",title:s.value.SetpTitle+"1"},{default:x(()=>[(p(!0),y(ee,null,te(s.value.Setp1Content,(l,R)=>(p(),y("div",{key:R},f(l),1))),128))]),_:1},8,["title"])):ve("",!0),M(o,{disabled:!1,class:"center",theme:"image",multiple:!1,draggable:!1,showImageFileName:!0,abridgeName:[3,8],files:Ee.value,"onUpdate:files":t[0]||(t[0]=l=>Ee.value=l),autoUpload:!1,sizeLimit:{size:10,unit:"MB"},onChange:et},null,8,["files"]),w.value===2?(p(),Z(n,{key:1,theme:"warning",title:s.value.SetpTitle+"2"},{default:x(()=>[(p(!0),y(ee,null,te(s.value.Setp2Content,(l,R)=>(p(),y("div",{key:R},f(l),1))),128))]),_:1},8,["title"])):w.value===3?(p(),Z(r,{key:2},{default:x(()=>[M(n,{theme:"warning",title:s.value.SetpTitle+"3"},{default:x(()=>[(p(!0),y(ee,null,te(s.value.Setp3Content,(l,R)=>(p(),y("div",{key:R},f(l),1))),128))]),_:1},8,["title"]),M(n,{theme:"info",title:s.value.ContourAlgorithmTitle},{default:x(()=>[(p(!0),y(ee,null,te(s.value.ContourAlgorithmContent,(l,R)=>(p(),y("div",{key:R},[l.strong?(p(),y("div",Ut,[T("strong",null,f(l.strong),1),B(f(l.normal),1)])):(p(),y("div",zt,f(l),1))]))),128))]),_:1},8,["title"]),M(a,{onChange:lt,modelValue:re.value,"onUpdate:modelValue":t[1]||(t[1]=l=>re.value=l),radioContentArr:s.value.ContourAlgorithmArr},null,8,["modelValue","radioContentArr"]),M(n,{theme:"info",title:s.value.ContourMaskTitle},{default:x(()=>[(p(!0),y(ee,null,te(s.value.ContourMaskContent,(l,R)=>(p(),y("div",{key:R},[l.strong?(p(),y("div",Yt,[T("strong",null,f(l.strong),1),B(f(l.normal),1)])):(p(),y("div",Wt,f(l),1))]))),128))]),_:1},8,["title"]),M(a,{modelValue:be.value,"onUpdate:modelValue":t[2]||(t[2]=l=>be.value=l),radioContentArr:s.value.ContourMaskContentArr},null,8,["modelValue","radioContentArr"])]),_:1})):w.value===4?(p(),Z(n,{key:3,theme:"warning",title:s.value.SetpTitle+"4"},{default:x(()=>[(p(!0),y(ee,null,te(s.value.Setp4Content,(l,R)=>(p(),y("div",{key:R},f(l),1))),128))]),_:1},8,["title"])):ve("",!0),T("div",Xt,[Dt(T("canvas",{ref_key:"canvasRef",ref:S,onClick:Qe},null,512),[[Lt,w.value>=2]])]),w.value===2?(p(),y("div",jt,[M(i,{onClick:t[3]||(t[3]=l=>Oe(!1)),block:!1},{default:x(()=>[B(f(s.value.CutPictureButtonText),1)]),_:1}),M(i,{onClick:t[4]||(t[4]=l=>Oe(!0)),block:!1,theme:"danger"},{default:x(()=>[B(f(s.value.CutPictureCompleteButtonText),1)]),_:1})])):w.value===3?(p(),Z(r,{key:5,size:"small"},{default:x(()=>[B(f(s.value.ContourSliderMainParameterLabelArr[re.value])+" ",1),M(h,{onChange:Te,onChangeEnd:ye,modelValue:_.value[0][0],"onUpdate:modelValue":t[5]||(t[5]=l=>_.value[0][0]=l),min:_.value[0][1],max:_.value[0][2],marks:_.value[0][3],step:1,range:!1,inputNumberProps:!1,label:!0,layout:"horizontal"},null,8,["modelValue","min","max","marks"]),M(m),re.value===0?(p(),Z(r,{key:0,size:"small"},{default:x(()=>[B(f(s.value.ContourSliderAuxiliaryParameterLabel)+" ",1),M(h,{onChange:Te,onChangeEnd:ye,modelValue:_.value[1][0],"onUpdate:modelValue":t[6]||(t[6]=l=>_.value[1][0]=l),min:_.value[1][1],max:_.value[1][2],marks:_.value[1][3],step:1,range:!1,inputNumberProps:!1,label:!0,layout:"horizontal"},null,8,["modelValue","min","max","marks"]),M(m)]),_:1})):ve("",!0),T("div",qt,[M(i,{onClick:st,block:!1,theme:le.value?"primary":"warning"},{default:x(()=>[B(f(le.value?s.value.ContourSliderSwitchFineButtonLabel:s.value.ContourSliderSwitchCoarseButtonLabel),1)]),_:1},8,["theme"]),M(i,{onClick:ct,block:!1,theme:"danger"},{default:x(()=>[B(f(s.value.ContourDetermineButtonLabel),1)]),_:1})])]),_:1})):w.value===4?(p(),Z(r,{key:6,size:"small"},{default:x(()=>[B(f(s.value.InterceptLeftSliderLabel)+" ",1),M(h,{onChange:Te,onChangeEnd:ye,modelValue:V.value[0][0],"onUpdate:modelValue":t[7]||(t[7]=l=>V.value[0][0]=l),min:V.value[0][1],max:V.value[0][2],marks:V.value[0][3],step:1,range:!1,inputNumberProps:!1,label:!0,layout:"horizontal"},null,8,["modelValue","min","max","marks"]),M(m),B(" "+f(s.value.InterceptRightSliderLabel)+" ",1),M(h,{onChange:Te,onChangeEnd:ye,modelValue:V.value[1][0],"onUpdate:modelValue":t[8]||(t[8]=l=>V.value[1][0]=l),min:V.value[1][1],max:V.value[1][2],marks:V.value[1][3],step:1,range:!1,inputNumberProps:!1,label:!0,layout:"horizontal"},null,8,["modelValue","min","max","marks"]),M(m),T("div",Jt,[M(i,{onClick:pt,block:!1,theme:"default"},{default:x(()=>[B(f(s.value.StepBackButtonLabel),1)]),_:1}),M(i,{onClick:Ct,block:!1,theme:"primary"},{default:x(()=>[B(f(s.value.BaselineConfirmButtonLabel),1)]),_:1})])]),_:1})):ve("",!0),((b=Re.value)==null?void 0:b.length)!==0?(p(),Z(r,{key:7,size:"small"},{default:x(()=>[T("div",null,[T("div",$t,[T("table",null,[T("thead",null,[T("tr",null,[(p(!0),y(ee,null,te(s.value.ResultTableContent,(l,R)=>(p(),y("th",{key:R},f(l),1))),128)),T("th",null,f(s.value.ResultTableProcessingLabel),1)])]),T("tbody",null,[(p(!0),y(ee,null,te(Re.value,(l,R)=>{var G,Y,U,W,I,X;return p(),y("tr",{key:R},[T("td",null,f(l[0]+1),1),T("td",null,f(l[1]),1),T("td",null,f((G=l[2])==null?void 0:G.toFixed(2)),1),T("td",null,f((Y=l[3])==null?void 0:Y.toFixed(2)),1),T("td",null,f((U=l[4])==null?void 0:U.toFixed(2)),1),T("td",null,f((W=l[5])==null?void 0:W.toFixed(2)),1),T("td",null,f((I=l[6])==null?void 0:I.toFixed(2)),1),T("td",null,f((X=l[7])==null?void 0:X.toFixed(4)),1),T("td",null,[M(i,{onClick:K=>bt(l[0]),block:!1,theme:"danger"},{default:x(()=>[B(f(s.value.ResultTableDeleteButtonLabel),1)]),_:1},8,["onClick"])])])}),128))])])]),M(v,{current:Ae.value,"onUpdate:current":t[9]||(t[9]=l=>Ae.value=l),total:ne.value.length,showFirstAndLastPageBtn:!1,showJumper:!0,showPageNumber:!1,showPageSize:!1,showPreviousAndNextBtn:!0},null,8,["current","total"]),M(m)]),T("div",Kt,[M(i,{onClick:Rt,block:!1,theme:"default"},{default:x(()=>[B(f(Me.value===!1?s.value.ResultTableReverseButtonLabel:s.value.ResultTableNormalButtonLabel),1)]),_:1}),M(i,{onClick:xt,block:!1,theme:"primary"},{default:x(()=>[B(f(s.value.ResultTableExportButtonLabel),1)]),_:1}),M(i,{onClick:Mt,block:!1,theme:"danger"},{default:x(()=>[B(f(s.value.DeleteAllResultButtonLabel),1)]),_:1})])]),_:1})):ve("",!0)]}),_:1})}}},an=yt(Qt,[["__scopeId","data-v-3d47a415"]]);export{an as default};
